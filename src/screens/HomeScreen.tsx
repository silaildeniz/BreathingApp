import React, { useEffect, useState, useContext } from 'react';
import {
  View,
  Text,
  StyleSheet,
  TouchableOpacity,
  ScrollView,
  Dimensions,
  Alert,
  Animated,
  ImageBackground,
  Modal,
  Image,
} from 'react-native';
import { useNavigation, useFocusEffect, CommonActions } from '@react-navigation/native';
import { StackNavigationProp } from '@react-navigation/stack';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { logout, getCurrentUser } from '../services/authService';
import { getUserProgram, getUserStats } from '../services/firestoreService';
import { PersonalizedProgram } from '../utils/programGenerator';
import { colors, theme } from '../constants/colors';
import { FONTS, standardTextStyles } from '../constants/typography';
import { HapticFeedback, triggerHapticFeedback, HapticType } from '../utils/hapticFeedback';
import { checkPremiumStatus, deactivatePremium } from '../utils/premiumUtils';
import { openManageSubscriptions } from '../services/iapService';
import { AuthContext } from '../contexts/AuthContext';
import { useTheme } from '../contexts/ThemeContext';
import { logError, logInfo, logUserAction, logWarn } from '../utils/logger';

const { width, height } = Dimensions.get('window');

type HomeScreenNavigationProp = StackNavigationProp<any, 'Home'>;

// Her teknik i√ßin 1 d√∂ng√º s√ºresi (saniye)
const CYCLE_DURATIONS: { [key: string]: number } = {
  'diaphragmatic': 10,
  '4-7-8': 19,
  'box-breathing': 8,
  'kapalabhati': 2,
  'nadi-shodhana': 8,
  'anxiety-relief': 10,
  'ujjayi': 8,
  'sitkari': 8,
  'lion_breath': 6,
  'pursed_lip_breathing': 9,
};

// Teknik isimlerini T√ºrk√ße'ye √ßeviren fonksiyon
const getTechniqueDisplayName = (technique: string): string => {
  const techniqueNames: { [key: string]: string } = {
    'diaphragmatic': 'Diyafram Nefesi',
    '4-7-8': '4-7-8 Tekniƒüi',
    'box-breathing': 'Kutu Nefesi',
    'kapalabhati': 'Kapalabhati',
    'nadi-shodhana': 'Nadi Shodhana',
    'anxiety-relief': 'Anksiyete Rahatlatma',
    'ujjayi': 'Ujjayi',
    'sitkari': 'Sitkari',
    'deep_breathing': 'Derin Nefes',
    'coherent_breathing': 'Uyumlu Nefes',
    'equal_breathing': 'E≈üit Nefes',
    'alternate_nostril': 'Alternatif Burun',
    'bhramari': 'Bhramari',
    'mindful_breathing': 'Farkƒ±ndalƒ±k Nefesi',
    'lion_breath': 'Aslan Nefesi',
    'pursed_lip_breathing': 'Dudak B√ºzme',
    'sitali': 'Sitali',
    'victorious_breath': 'Zafer Nefesi',
    'three_part_breath': '√ú√ß B√∂l√ºm Nefesi',
    'alternate_nostril_advanced': 'Geli≈ümi≈ü Alternatif Burun',
    'bhramari_advanced': 'Geli≈ümi≈ü Bhramari',
  };
  
  return techniqueNames[technique] || technique;
};

// Pastel renkler
const STAT_CARD_COLORS = [
  '#E0F7FA', // pastel mavi
  '#E8F5E9', // pastel ye≈üil
  '#FFFFFF', // beyaz
  '#B3E5FC', // a√ßƒ±k mavi
  '#C8E6C9', // a√ßƒ±k ye≈üil
];
const STAT_CARD_ICONS = [
  'üèÜ', // Toplam Egzersiz
  '‚è≥', // Toplam S√ºre
  'üî•', // Seri
  'üìÖ', // Son Egzersiz
  'üíô', // En √áok Yapƒ±lan Teknik
];

export default function HomeScreen() {
  const navigation = useNavigation<HomeScreenNavigationProp>();
  const { isGuest, logout } = useContext(AuthContext);
  const [userName, setUserName] = useState<string>('');
  // autoStart kaldƒ±rƒ±ldƒ± (√∂nceki state kaldƒ±rƒ±ldƒ±)
  type UserProgramState = {
    program: PersonalizedProgram[];
    completedDays: number[] | string[];
    currentDay: number;
    isPremium?: boolean;
  } | null;
  const [userProgram, setUserProgram] = useState<UserProgramState>(null);
  const [completedDays, setCompletedDays] = useState<number[]>([]);
  const [currentDay, setCurrentDay] = useState(1);
  const [isLoading, setIsLoading] = useState(true);
  const [userStats, setUserStats] = useState({
    totalSessions: 0,
    totalMinutes: 0,
    currentStreak: 0,
  });
  const { themeColors } = useTheme();
  const [cycleCount, setCycleCount] = useState(5);
  const [backgroundLoaded, setBackgroundLoaded] = useState(false);

  // ƒ∞statistikler i√ßin √∂rnek state (ileride ger√ßek verilerle doldurulacak)
  type StatsType = {
    totalSessions: number;
    currentStreak: number;
    longestStreak: number;
    lastSessionDate: string;
    favoriteTechniques: string[];
    techniqueCounts: { [key: string]: number };
    lastSessionTechnique: string;
  };
  const [stats, setStats] = useState<StatsType>({
    totalSessions: 0,
    currentStreak: 0,
    longestStreak: 0,
    lastSessionDate: '-',
    favoriteTechniques: [],
    techniqueCounts: {},
    lastSessionTechnique: '-',
  });

  // Animasyon i√ßin state
  const [fadeAnim] = useState(new Animated.Value(0));
  
  // Dikkat butonu i√ßin state
  const [showWarningModal, setShowWarningModal] = useState(false);
  const [warningAnim] = useState(new Animated.Value(1));
  const [isPremium, setIsPremium] = useState(false);
  const [showProgramOptionsModal, setShowProgramOptionsModal] = useState(false);

  const preloadBackground = async () => {
    // Local dosyalar i√ßin preloading'e gerek yok, sadece onLoad handler kullanƒ±lacak
    setBackgroundLoaded(true);
  };

  // Firebase'den kullanƒ±cƒ± verilerini y√ºkle
  const loadUserData = async () => {
    try {
      logInfo('HomeScreen: loadUserData ba≈üladƒ±');
      const currentUser = getCurrentUser();
      if (!currentUser) {
        logWarn('HomeScreen: Kullanƒ±cƒ± bulunamadƒ±');
        setIsLoading(false);
        return;
      }

      // Kullanƒ±cƒ± adƒ±nƒ± al
      const displayName = currentUser.displayName;
      setUserName(displayName || '');

      // √ñnce premium durumunu kontrol et
      const premiumStatus = await checkPremiumStatus();
      logInfo('HomeScreen: Premium durumu kontrol edildi:', premiumStatus);
      
      // Premium iptal edilmi≈üse, t√ºm premium verileri temizle
      if (!premiumStatus) {
        logInfo('HomeScreen: Premium durumu false, premium veriler temizleniyor');
        setIsPremium(false);
        setUserProgram(null);
        
        // Premium olmayan normal programƒ± y√ºkle
        logInfo('HomeScreen: Normal program y√ºkleniyor...');
      const programData = await getUserProgram(currentUser.uid);
        
        if (programData && !programData.isPremium) {
          // Normal program var
          const userProgramData = {
            program: programData.program || [],
            completedDays: programData.completedDays || [],
            currentDay: programData.currentDay || 1,
            isPremium: false,
          };
          setUserProgram(userProgramData);
          logInfo('HomeScreen: Normal program y√ºklendi');
          logInfo('HomeScreen: currentDay:', userProgramData.currentDay);
          logInfo('HomeScreen: completedDays:', userProgramData.completedDays);
      } else {
          // Normal program da yok, AsyncStorage'dan kontrol et
          logInfo('HomeScreen: Firestore\'da normal program yok, AsyncStorage kontrol ediliyor...');
          const { getStoredProgram } = await import('../utils/programStorage');
          const storedProgram = await getStoredProgram();
          
          if (storedProgram) {
            const userProgramData = {
              program: storedProgram.program,
              completedDays: storedProgram.completedDays,
              currentDay: storedProgram.currentDay,
              isPremium: false,
            };
            setUserProgram(userProgramData);
            logInfo('HomeScreen: AsyncStorage\'dan normal program y√ºklendi');
            logInfo('HomeScreen: currentDay:', userProgramData.currentDay);
            logInfo('HomeScreen: completedDays:', userProgramData.completedDays);
          } else {
            // Legacy anahtar ile kayƒ±t edilmi≈ü olabilir: 'user_program'
            try {
              const legacyUserProgramJson = await AsyncStorage.getItem('user_program');
              if (legacyUserProgramJson) {
                const legacy = JSON.parse(legacyUserProgramJson);
                const userProgramData = {
                  program: legacy.program || [],
                  completedDays: legacy.completedDays || [],
                  currentDay: legacy.currentDay || 1,
                  isPremium: false,
                };
                setUserProgram(userProgramData);
                logInfo('HomeScreen: Legacy user_program anahtarƒ±ndan program y√ºklendi');
              } else {
                logInfo('HomeScreen: Hi√ßbir yerde program bulunamadƒ± - userProgram null olarak ayarlanƒ±yor');
                setUserProgram(null);
              }
            } catch (e) {
              logWarn('HomeScreen: Legacy user_program okumasƒ± ba≈üarƒ±sƒ±z, program yok sayƒ±lƒ±yor');
              setUserProgram(null);
            }
          }
        }
      } else {
        // Premium aktif, premium programƒ± y√ºkle
        logInfo('HomeScreen: Premium aktif, premium program y√ºkleniyor...');
        const programData = await getUserProgram(currentUser.uid);
        
        if (programData && programData.isPremium) {
          const userProgramData = {
            program: programData.program || [],
            completedDays: programData.completedDays || [],
            currentDay: programData.currentDay || 1,
            isPremium: true,
          };
          setUserProgram(userProgramData);
          setIsPremium(true);
          logInfo('HomeScreen: Premium program y√ºklendi');
        } else {
          logWarn('HomeScreen: Premium durumu true ama premium program bulunamadƒ±');
          setIsPremium(false);
          setUserProgram(null);
        }
      }

      logInfo('HomeScreen: Firestore\'dan istatistik verisi alƒ±nƒ±yor...');
      // Firestore'dan kullanƒ±cƒ± istatistiklerini al
      const statsData = await getUserStats(currentUser.uid);
      logInfo('HomeScreen: ƒ∞statistik verisi alƒ±ndƒ±');
      
      if (statsData) {
        setStats({
          totalSessions: statsData.totalSessions ?? 0,
          currentStreak: statsData.currentStreak ?? 0,
          longestStreak: statsData.longestStreak ?? 0,
          lastSessionDate: statsData.lastSessionDate ?? '-',
          favoriteTechniques: statsData.favoriteTechniques ?? [],
          techniqueCounts: statsData.techniqueCounts ?? {},
          lastSessionTechnique: statsData.lastSessionTechnique ?? '-',
        });
      }

      // Otomatik ba≈ülatma ayarƒ±nƒ± y√ºkle
      // auto_start_enabled kaldƒ±rƒ±ldƒ±

      setIsLoading(false);
      logInfo('HomeScreen: loadUserData tamamlandƒ±');
    } catch (error) {
      logError('Kullanƒ±cƒ± verileri y√ºklenirken hata', error);
      setIsLoading(false);
    }
  };

  // Optimized useEffect - Consolidate all initialization logic
  useEffect(() => {
    logInfo('HomeScreen: ƒ∞lk useEffect tetiklendi');
    
    // Animasyonlarƒ± ba≈ülat
    Animated.timing(fadeAnim, {
      toValue: 1,
      duration: 700,
      useNativeDriver: true,
    }).start();

    // Dikkat butonu yanƒ±p s√∂nme animasyonu
    const blinkAnimation = Animated.loop(
      Animated.sequence([
        Animated.timing(warningAnim, {
          toValue: 0.3,
          duration: 800,
          useNativeDriver: true,
        }),
        Animated.timing(warningAnim, {
          toValue: 1,
          duration: 800,
          useNativeDriver: true,
        }),
      ])
    );
    blinkAnimation.start();

    // ƒ∞lk y√ºkleme i≈ülemleri
    const initializeScreen = async () => {
      await preloadBackground();
      await loadUserData();

      // D√∂ng√º sayƒ±sƒ±nƒ± AsyncStorage'dan oku
      try {
        const stored = await AsyncStorage.getItem('cycle_count');
        if (stored) setCycleCount(parseInt(stored));
      } catch {}
    };
    
    initializeScreen();

    // Cleanup function
    return () => {
      blinkAnimation.stop();
    };
  }, []); // Empty dependency array - only run once

  // Focus effect - Her fokus olduƒüunda program verisini g√ºncelle
  useFocusEffect(
    React.useCallback(() => {
      logInfo('HomeScreen: useFocusEffect tetiklendi - Program verisi yenileniyor');
      const refreshData = async () => {
        try {
          const currentUser = getCurrentUser();
          if (!currentUser) return;

          // Firestore'dan programƒ± √ßek
          const programData = await getUserProgram(currentUser.uid);

          if (programData) {
            if ((programData as any).isPremium) {
              setIsPremium(true);
              const userProgramData = {
                program: programData.program || [],
                completedDays: programData.completedDays || [],
                currentDay: programData.currentDay || 1,
                isPremium: true,
              };
              setUserProgram(userProgramData);
              logInfo('HomeScreen: Premium/Normal program g√ºncellendi (focus)');
            } else {
              setIsPremium(false);
              const userProgramData = {
                program: programData.program || [],
                completedDays: programData.completedDays || [],
                currentDay: programData.currentDay || 1,
                isPremium: false,
              };
              setUserProgram(userProgramData);
              logInfo('HomeScreen: Normal program g√ºncellendi (focus)');
            }
          } else {
            // Firestore yoksa AsyncStorage'dan dene
            const { getStoredProgram } = await import('../utils/programStorage');
            const storedProgram = await getStoredProgram();
            if (storedProgram) {
              setIsPremium(false);
              const userProgramData = {
                program: storedProgram.program,
                completedDays: storedProgram.completedDays,
                currentDay: storedProgram.currentDay,
                isPremium: false,
              };
              setUserProgram(userProgramData);
              logInfo('HomeScreen: AsyncStorage programƒ± g√ºncellendi (focus)');
            }
          }
        } catch (error) {
          logError('Focus effect veri yenileme hatasƒ±:', error);
        }
      };

      refreshData();
    }, [])
  );

  // Navigation stack'ini temizleme i≈ülemini kaldƒ±rdƒ±k - sonsuz d√∂ng√ºye neden oluyordu

  const handleLogout = async () => {
    try {
      triggerHapticFeedback(HapticType.MEDIUM);
      logUserAction('Logout');
              await logout();
      // AuthContext'teki logout fonksiyonu otomatik olarak Welcome ekranƒ±na y√∂nlendirecek
    } catch (error) {
      logError('Logout error', error);
      Alert.alert('Hata', '√áƒ±kƒ±≈ü yapƒ±lƒ±rken bir hata olu≈ütu.');
    }
  };

  const handleStartExercise = (technique: string, duration?: string) => {
    HapticFeedback.medium();
    logUserAction('Start Exercise', { technique, duration });
    
    navigation.navigate('BreathingExercise', {
      technique,
      duration,
      title: technique,
      description: `${duration} dakikalƒ±k ${technique} egzersizi`,
      isPremium: false,
      programDay: undefined,
      session: undefined
    });
  };

  const handleAssessment = () => {
    HapticFeedback.medium();
    logUserAction('Show Program Options');
    setShowProgramOptionsModal(true);
  };

  const handlePersonalizedProgram = () => {
    HapticFeedback.medium();
    logUserAction('Navigate to Personalized Program');
    
    if (isGuest) {
      Alert.alert(
        'Giri≈ü Gerekli',
        'Ki≈üisel programƒ±nƒ±zƒ± g√∂r√ºnt√ºlemek i√ßin giri≈ü yapmanƒ±z gerekmektedir.',
        [
          {
            text: 'ƒ∞ptal',
            style: 'cancel'
          },
          {
            text: 'Giri≈ü Yap',
            onPress: () => navigation.navigate('Login')
          }
        ]
      );
    } else {
      navigation.navigate('PersonalizedProgram');
    }
  };

  const handleSettings = () => {
    HapticFeedback.medium();
    logUserAction('Navigate to Settings');
    navigation.navigate('Settings');
  };

  const handleWarningModal = () => {
    HapticFeedback.medium();
    logUserAction('Open Warning Modal');
    setShowWarningModal(true);
  };

  // Premium √∂zellikler i√ßin handler'lar
  const handlePremiumAssessment = () => {
    HapticFeedback.medium();
    logUserAction('Navigate to Premium Assessment');
    navigation.navigate('PremiumAssessment');
  };

  const handlePremiumProgram = () => {
    HapticFeedback.medium();
    logUserAction('Navigate to Premium Program');
    navigation.navigate('PremiumProgram');
  };

  const handleManageSubscription = async () => {
    logUserAction('Open Manage Subscription');
    const ok = await openManageSubscriptions();
    if (!ok) {
      Alert.alert('Hata', 'Abonelik y√∂netim sayfasƒ± a√ßƒ±lamadƒ±.');
    }
  };

  const handleDeactivatePremium = async () => {
    logUserAction('Deactivate Premium Request');
    Alert.alert(
      'Premium ƒ∞ptal Et',
      'Premium aboneliƒüinizi iptal etmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz ve premium √∂zelliklerinize eri≈üiminiz kaybolacaktƒ±r.',
      [
        {
          text: 'ƒ∞ptal',
          style: 'cancel'
        },
        {
          text: 'Premium\'u ƒ∞ptal Et',
          style: 'destructive',
          onPress: async () => {
            try {
              logInfo('Premium iptal i≈ülemi ba≈ülatƒ±lƒ±yor...');
              
              // Premium iptal i≈ülemini ger√ßekle≈ütir
              await deactivatePremium();
              logUserAction('Premium Deactivated');
              
              // State'leri tamamen temizle
              setIsPremium(false);
              setUserProgram(null); // Program verilerini tamamen temizle
              
              logInfo('Premium iptal sonrasƒ± state temizlendi');
              
              Alert.alert(
                'Premium ƒ∞ptal Edildi',
                'Premium aboneliƒüiniz ba≈üarƒ±yla iptal edildi. T√ºm premium verileriniz temizlendi. Ne yapmak istiyorsunuz?',
                [
                  {
                    text: 'Yeni Deƒüerlendirme',
                    onPress: () => {
                      logUserAction('Navigate to Assessment after premium deactivation');
      navigation.navigate('Assessment');
    }
                  },
                  {
                    text: 'Ana Sayfa',
                    onPress: () => {
                      logUserAction('Stay on Home after premium deactivation');
                      // Sadece premium durumunu g√ºncelle
                      setIsPremium(false);
                      setUserProgram(null);
                    }
                  }
                ]
              );
            } catch (error) {
              logError('Premium iptal hatasƒ±', error);
              Alert.alert(
                'Hata', 
                'Premium iptal edilirken bir hata olu≈ütu. L√ºtfen tekrar deneyin.',
                [
                  {
                    text: 'Tamam',
                    onPress: () => {
                      // Hata durumunda hi√ßbir ≈üey yapma
                      logInfo('Premium iptal hatasƒ± kabul edildi');
                    }
                  }
                ]
              );
            }
          }
        }
      ]
    );
  };

  // Egzersiz kartlarƒ±nda s√ºreyi hesaplayan yardƒ±mcƒ± fonksiyon
  const getExerciseDurationText = (technique: string) => {
    const cycleDuration = CYCLE_DURATIONS[technique] || 10;
    const totalSeconds = cycleDuration * cycleCount;
    return `${totalSeconds} saniye`;
  };

  if (isLoading) {
    return (
      <View style={[styles.loadingContainer, { backgroundColor: themeColors.background }]}>
        <Text style={[styles.loadingText, { color: themeColors.text }]}>Y√ºkleniyor...</Text>
      </View>
    );
  }

  return (
    <ImageBackground source={require('../../assets/backgrounds/arkaplan.jpg')} style={styles.backgroundImage} resizeMode="cover" onLoad={() => setBackgroundLoaded(true)}>
      <ScrollView style={[styles.container, { backgroundColor: 'transparent' }]} showsVerticalScrollIndicator={false}>
        {/* Header */}
        <View style={styles.header}>
          <Text style={[standardTextStyles.sectionTitle, { color: '#F5F5DC', flex: 1, fontWeight: '700', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>
            {userName ? `Ho≈ü Geldin ${userName}!` : 'Ho≈ü Geldin!'}
          </Text>
          
          {/* Dikkat Butonu - Herkes g√∂recek */}
          <Animated.View style={{ opacity: warningAnim, marginRight: 8 }}>
            <TouchableOpacity 
              style={[styles.warningButton, { backgroundColor: 'rgba(255, 193, 7, 0.2)', borderColor: '#FFC107', borderWidth: 1 }]} 
              onPress={handleWarningModal}
            >
              <Text style={[standardTextStyles.buttonSmall, { color: '#FFC107', fontWeight: 'bold' }]}>‚ö†Ô∏è</Text>
            </TouchableOpacity>
          </Animated.View>
          
          {!isGuest && (
            <TouchableOpacity 
              style={[styles.logoutButton, { backgroundColor: 'transparent', borderColor: '#DDD', borderWidth: 1 }]} 
              onPress={handleLogout}
            >
              <Text style={[standardTextStyles.buttonSmall, { color: '#F5F5DC' }]}>√áƒ±kƒ±≈ü</Text>
            </TouchableOpacity>
          )}
        </View>

        {/* Program Status - Premium ve Normal kullanƒ±cƒ±lar i√ßin */}
        {!isGuest && (
          <View style={[styles.programCard, { 
            backgroundColor: 'rgba(245, 245, 220, 0.1)', 
            borderColor: 'rgba(255, 215, 0, 0.8)', 
            borderWidth: 3,
            borderTopWidth: 3,
            borderBottomWidth: 3,
            borderLeftWidth: 3,
            borderRightWidth: 3,
            borderTopColor: 'rgba(255, 215, 0, 0.8)',
            borderBottomColor: 'rgba(255, 215, 0, 0.8)',
            borderLeftColor: 'rgba(255, 215, 0, 0.8)',
            borderRightColor: 'rgba(255, 215, 0, 0.8)',
            shadowColor: 'transparent' 
          }]}> 
            {isPremium && userProgram ? (
              // Premium kullanƒ±cƒ± - Premium program
              <>
                <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: 8 }}>
                  <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', flex: 1, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Ki≈üisel Programƒ±nƒ±z</Text>
                  <TouchableOpacity
                    style={{
                      backgroundColor: 'rgba(33, 150, 243, 0.2)',
                      borderColor: '#2196F3',
                      borderWidth: 2,
                      borderRadius: 8,
                      paddingHorizontal: 8,
                      paddingVertical: 6,
                      marginLeft: 10
                    }}
                    onPress={handleManageSubscription}
                  >
                    <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', fontSize: 12, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Aboneliƒüi Y√∂net</Text>
                  </TouchableOpacity>
                </View>
                <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 10, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>G√ºn {userProgram.currentDay} / 21</Text>
                {/* Premium kartta tamamlanan egzersiz sayƒ±sƒ±nƒ± g√∂stermiyoruz */}
                <TouchableOpacity
                  style={[styles.programButton, { backgroundColor: 'rgba(255, 215, 0, 0.2)', borderColor: '#FFD700', borderWidth: 1 }]}
                  onPress={handlePremiumProgram}
                >
                  <Text style={[standardTextStyles.buttonMedium, { color: '#F5F5DC', textAlign: 'center', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Premium Programƒ± G√∂r√ºnt√ºle</Text>
                </TouchableOpacity>
              </>
            ) : userProgram ? (
              // Normal kullanƒ±cƒ± - Normal program
              <>
                <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 8, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>G√ºnl√ºk Nefes Yolculuƒüunuz</Text>
                <Text style={[standardTextStyles.bodySmall, { color: '#F5F5DC', marginBottom: 20, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>{userProgram.completedDays.length} g√ºn tamamlandƒ±</Text>
                <TouchableOpacity
                  style={[styles.programButton, { backgroundColor: 'rgba(245, 245, 220, 0.15)', borderColor: '#DDD', borderWidth: 1 }]}
              onPress={handlePersonalizedProgram}
            >
                  <Text style={[standardTextStyles.buttonMedium, { color: '#F5F5DC', textAlign: 'center', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Programƒ± G√∂r√ºnt√ºle</Text>
            </TouchableOpacity>
              </>
            ) : (
              // Program yoksa
              <>
                <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 8, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>G√ºnl√ºk Nefes Yolculuƒüun</Text>
                <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 20, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Size √∂zel ki≈üisel programƒ±nƒ±zƒ± olu≈üturun</Text>
                <TouchableOpacity
                  style={[styles.programButton, { backgroundColor: 'rgba(245, 245, 220, 0.15)', borderColor: '#DDD', borderWidth: 1 }]}
                  onPress={handleAssessment}
                >
                  <Text style={[standardTextStyles.buttonMedium, { color: '#F5F5DC', textAlign: 'center', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>G√ºnl√ºk Nefes Yolculuƒüu Olu≈ütur</Text>
                </TouchableOpacity>
              </>
            )}
          </View>
        )}

        {/* Misafir kullanƒ±cƒ±lar i√ßin ki≈üisel program butonu */}
        {isGuest && (
          <View style={[styles.programCard, { 
            backgroundColor: 'rgba(245, 245, 220, 0.1)', 
            borderColor: 'rgba(255, 251, 0, 0.78)', 
            borderWidth: 3,
            borderTopWidth: 3,
            borderBottomWidth: 3,
            borderLeftWidth: 3,
            borderRightWidth: 3,
            borderTopColor: 'rgba(255, 215, 0, 0.8)',
            borderBottomColor: 'rgba(255, 215, 0, 0.8)',
            borderLeftColor: 'rgba(255, 215, 0, 0.8)',
            borderRightColor: 'rgba(255, 215, 0, 0.8)',
            shadowColor: colors.primary[300] 
          }]}> 
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 8, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>G√ºnl√ºk Nefes Yolculuƒüun</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 20, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Giri≈ü yaparak g√ºnl√ºk ki≈üisel programƒ±nƒ±zƒ± olu≈üturun</Text>
            <TouchableOpacity
              style={[styles.programButton, { backgroundColor: 'rgba(245, 245, 220, 0.15)', borderColor: '#DDD', borderWidth: 1 }]}
              onPress={() => navigation.navigate('Login')}
            >
              <Text style={[standardTextStyles.buttonMedium, { color: '#F5F5DC', textAlign: 'center', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Giri≈ü Yap</Text>
            </TouchableOpacity>
          </View>
        )}

        {/* Quick Exercises */}
        <View style={styles.quickExercises}>
          <Text style={[standardTextStyles.sectionTitle, { color: '#F5F5DC', fontWeight: '700', marginBottom: 20, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Hƒ±zlƒ± Egzersizler</Text>
          
          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(135, 206, 235, 0.8)',
            }]}
            onPress={() => handleStartExercise('diaphragmatic', '5')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Sakinle≈ü Ve Rahatla</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Karnƒ±nƒ± ≈üi≈üererek diyafram kasƒ±nƒ± aktif kullan ve sakinle≈ü!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(147, 112, 219, 0.8)',
            }]}
            onPress={() => handleStartExercise('4-7-8', '5')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Rahat√ßa Uykuya Ge√ß</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>4-7-8 ritmi ile stresi sƒ±fƒ±ra indir rahat√ßa uykuya ge√ß!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(100, 149, 237, 0.8)',
            }]}
            onPress={() => handleStartExercise('box-breathing', '4')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Odaklan Ve Dengelen</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Box tekniƒüi ve e≈üit s√ºreli 4'l√ºk d√∂ng√ºlerle zihnini dengele ve odaklanmanƒ± arttƒ±r!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(255, 165, 0, 0.8)',
            }]}
            onPress={() => handleStartExercise('kapalabhati', '3')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Zihnini Uyandƒ±r</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Kapalabhati tekniƒüi ile hƒ±zlƒ± nefes alƒ±≈ü veri≈ülerle zihnini canlandƒ±r!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(87, 224, 87, 0.64)',
            }]}
            onPress={() => handleStartExercise('nadi-shodhana', '5')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Enerjini Dengele</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Nadi Shodhana tekniƒüi ile enerji kanallarƒ±nƒ± dengele ve sakinle≈ü!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(255, 182, 193, 0.8)',
            }]}
            onPress={() => handleStartExercise('anxiety-relief', '5')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Anksiyeteyi Rahatlat</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Panik ataklarƒ±nƒ±n √∂n√ºne ge√ßerek sakinle≈ü!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(112, 64, 156, 0.8)',
            }]}
            onPress={() => handleStartExercise('ujjayi', '5')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Odaklan Ve Enerji Al</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Ujjayi (Zafer Nefesi) ile boƒüazƒ±nƒ± daraltarak odaklanmanƒ± arttƒ±r ve enerji al!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(173, 216, 230, 0.8)',
            }]}
            onPress={() => handleStartExercise('sitkari', '5')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Soƒüut Ve Sakinle≈ü</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Sitkari (Di≈ü Nefesi) ile di≈ülerini sƒ±karak anksiyeteyi azalt!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(168, 144, 7, 0.8)',
            }]}
            onPress={() => handleStartExercise('lion_breath', '3')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Aslan Nefesi ƒ∞le G√º√ßlen</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Aƒüzƒ±nƒ±zƒ± a√ßƒ±p dilinizi √ßƒ±kararak √∂zg√ºvenini arttƒ±r!</Text>
          </TouchableOpacity>

          <TouchableOpacity
            style={[styles.exerciseCard, { 
              backgroundColor: 'rgba(245, 245, 220, 0.1)', 
              borderColor: '#DDD', 
              borderWidth: 1,
              borderLeftWidth: 8,
              borderLeftColor: 'rgba(240, 128, 128, 0.8)',
            }]}
            onPress={() => handleStartExercise('pursed_lip_breathing', '5')}
          >
            <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>B√ºz√ºk Dudakla Rahatla</Text>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', marginBottom: 6, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Dudaklarƒ±nƒ±zƒ± b√ºzerek anksiyeteyi azaltƒ±n!</Text>
          </TouchableOpacity>
        </View>

        {/* Uyku M√ºzikleri Link */}
        <View style={styles.sleepMusicSection}>
          <Text style={[standardTextStyles.sectionTitle, { color: '#F5F5DC', fontWeight: '700', marginBottom: 22, fontSize: 22, marginLeft: 20, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}> Gece Melodileri</Text>

          <TouchableOpacity
            style={[styles.sleepMusicCard, { backgroundColor: 'rgba(245, 245, 220, 0.1)', borderColor: '#DDD', borderWidth: 1 }]}
            onPress={() => navigation.navigate('SleepMusic')}
          >
            <View style={styles.sleepMusicContent}>
              <Text style={styles.sleepMusicEmoji}>üéµ</Text>
              <View style={styles.sleepMusicTextContainer}>
                <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', marginBottom: 8, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Sakinle≈ütirici M√ºzikler</Text>
                
                <Text style={[standardTextStyles.bodySmall, { color: '#F5F5DC', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Yaƒümur, okyanus, orman sesleri ve daha fazlasƒ±</Text>
              </View>
              <Text style={styles.arrowIcon}>‚Üí</Text>
            </View>
          </TouchableOpacity>
        </View>

        {/* ƒ∞statistik Kartƒ± */}
        <Text style={[standardTextStyles.sectionTitle, { color: '#F5F5DC', marginLeft: 20, marginBottom: 8, marginTop: 20, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>ƒ∞statistikler</Text>
        {isGuest ? (
          <View style={{ alignItems: 'center', marginVertical: 24 }}>
            <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', textAlign: 'center', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>
              ƒ∞statistiklerinizi g√∂rebilmek i√ßin giri≈ü yapƒ±n.
            </Text>
          </View>
        ) : (
          <Animated.View style={{ opacity: fadeAnim, transform: [{ scale: fadeAnim.interpolate({ inputRange: [0, 1], outputRange: [0.95, 1] }) }] }}>
            <ScrollView horizontal showsHorizontalScrollIndicator={false} style={{ paddingLeft: 16, paddingBottom: 8 }}>
              {/* Seri */}
              <View style={[styles.statCard, { backgroundColor: 'rgba(245, 245, 220, 0.08)', borderWidth: 1, borderColor: '#DDD' }]}> 
                <Text style={{ fontSize: 24, marginBottom: 8 }}>üî•</Text>
                <Text style={[standardTextStyles.label, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Seri</Text>
                <Text style={[standardTextStyles.cardTitle, { color: '#F5F5DC', fontWeight: 'bold', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>{String(stats.currentStreak)} g√ºn</Text>
              </View>
              {/* Son Egzersiz */}
              <View style={[styles.statCard, { backgroundColor: 'rgba(245, 245, 220, 0.08)', borderWidth: 1, borderColor: '#DDD' }]}> 
                <Text style={{ fontSize: 24, marginBottom: 8 }}>üßò‚Äç‚ôÇÔ∏è</Text>
                <Text style={[standardTextStyles.label, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Son egzersiz</Text>
                <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', fontWeight: 'bold', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>{getTechniqueDisplayName(stats.lastSessionTechnique ?? '-')}</Text>
              </View>
              {/* En √áok Yapƒ±lan Nefes Tekniƒüi */}
              <View style={[styles.statCard, { backgroundColor: 'rgba(245, 245, 220, 0.08)', borderWidth: 1, borderColor: '#DDD' }]}> 
                <Text style={{ fontSize: 24, marginBottom: 8 }}>ü§ç</Text>
                <Text style={[standardTextStyles.label, { color: '#F5F5DC', marginBottom: 4, textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>En √ßok yapƒ±lan nefes tekniƒüi</Text>
                <Text style={[standardTextStyles.bodyMedium, { color: '#F5F5DC', fontWeight: 'bold', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>{stats.favoriteTechniques.length > 0 ? getTechniqueDisplayName(stats.favoriteTechniques[0]) : '-'}</Text>
              </View>
            </ScrollView>
          </Animated.View>
        )}



        {/* Action Buttons */}
        <View style={styles.actionButtons}>
          {!userProgram && !isGuest && (
            <TouchableOpacity
              style={[styles.assessmentButton, { backgroundColor: colors.secondary[500] }]}
              onPress={handleAssessment}
            >
              <Text style={[standardTextStyles.buttonLarge, { color: '#FFFFFF' }]}>Ki≈üisel Programƒ± Olu≈ütur</Text>
            </TouchableOpacity>
          )}

          <TouchableOpacity
            style={[styles.settingsButton, { backgroundColor: 'rgba(245, 245, 220, 0.15)', borderColor: '#DDD' }]}
            onPress={handleSettings}
          >
            <Text style={[standardTextStyles.buttonMedium, { color: '#F5F5DC', textAlign: 'center', textShadowColor: 'rgba(0, 0, 0, 0.8)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 2 }]}>Ayarlar</Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
      
      {/* Dikkat Modal */}
      <Modal
        visible={showWarningModal}
        transparent={true}
        animationType="fade"
        onRequestClose={() => setShowWarningModal(false)}
      >
        <View style={styles.modalOverlay}>
          <View style={styles.modalContent}>
            <Text style={styles.modalTitle}>‚ö†Ô∏è Nefes Teknikleri G√ºvenlik Uyarƒ±sƒ±</Text>
            
            <View style={styles.warningSection}>
              <Text style={styles.warningSectionTitle}>‚ùå Bu teknikler √∂nerilmez:</Text>
              <Text style={styles.warningText}>‚Ä¢ Kapalabhati: Hamileler, tansiyon hastalarƒ±, kalp hastalarƒ±</Text>
              <Text style={styles.warningText}>‚Ä¢ Nadi Shodhana: Kalp hastalarƒ±</Text>
              <Text style={styles.warningText}>‚Ä¢ Alternatif Burun Nefesi: Kalp hastalarƒ±</Text>
              <Text style={styles.warningText}>‚Ä¢ Box Breathing: Astƒ±m/bron≈üit hastalarƒ±</Text>
              <Text style={styles.warningText}>‚Ä¢ 4-7-8 Tekniƒüi: Astƒ±m/bron≈üit hastalarƒ±</Text>
              <Text style={styles.warningText}>‚Ä¢ Aslan Nefesi: Astƒ±m/bron≈üit hastalarƒ±</Text>
              <Text style={styles.warningText}>‚Ä¢ Zafer Nefesi: Astƒ±m/bron≈üit hastalarƒ±</Text>
            </View>
            
            <View style={styles.safeSection}>
              <Text style={styles.safeSectionTitle}>‚úÖ Bu teknikler g√ºvenlidir:</Text>
              <Text style={styles.safeText}>‚Ä¢ Diyafram nefesi: Herkes i√ßin g√ºvenli</Text>
              <Text style={styles.safeText}>‚Ä¢ Anksiyete rahatlatma: Panik atak i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ Uyumlu nefes: Kalp saƒülƒ±ƒüƒ± i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ Arƒ± nefesi: Uyku ve sakinlik i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ Soƒüutucu nefes: V√ºcut soƒüutma i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ Di≈ü nefesi: Anksiyete azaltma i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ √ú√ß par√ßa nefes: Derin rahatlama i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ E≈üit nefes: Denge i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ Dudak b√ºzme nefesi: Solunum kontrol√º i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ Derin nefes: Stres azaltma i√ßin</Text>
              <Text style={styles.safeText}>‚Ä¢ Farkƒ±ndalƒ±k nefesi: Meditasyon i√ßin</Text>
            </View>
            
            <View style={styles.ageSection}>
              <Text style={styles.ageSectionTitle}>üìä Ya≈ü Gruplarƒ±na G√∂re Yoƒüunluk:</Text>
              <Text style={styles.ageText}>‚Ä¢ 18-30 ya≈ü: Normal yoƒüunluk</Text>
              <Text style={styles.ageText}>‚Ä¢ 31-50 ya≈ü: %20 azaltƒ±lmƒ±≈ü yoƒüunluk</Text>
              <Text style={styles.ageText}>‚Ä¢ 50+ ya≈ü: %40 azaltƒ±lmƒ±≈ü yoƒüunluk</Text>
            </View>
            
            <TouchableOpacity
              style={styles.modalButton}
              onPress={() => setShowWarningModal(false)}
            >
              <Text style={styles.modalButtonText}>Tamam</Text>
            </TouchableOpacity>
          </View>
        </View>
      </Modal>

      {/* Program Se√ßenekleri Modal */}
      <Modal
        visible={showProgramOptionsModal}
        transparent={true}
        animationType="fade"
        onRequestClose={() => setShowProgramOptionsModal(false)}
      >
        <View style={styles.modalOverlay}>
          <View style={styles.modalContent}>
            <Text style={styles.modalTitle}>üéØ Program Se√ßimi</Text>
            
            <Text style={[standardTextStyles.bodyMedium, { color: '#333', textAlign: 'center', marginBottom: 24, lineHeight: 20 }]}>
              Hangi t√ºr program olu≈üturmak istiyorsunuz?
            </Text>
            
            <TouchableOpacity
              style={[styles.programOptionButton, { backgroundColor: 'rgba(76, 175, 80, 0.1)', borderColor: '#4CAF50', marginBottom: 12 }]}
              onPress={() => {
                setShowProgramOptionsModal(false);
                logUserAction('Navigate to Assessment (Free)');
                navigation.navigate('Assessment');
              }}
            >
              <Text style={[standardTextStyles.buttonMedium, { color: '#4CAF50', fontWeight: 'bold' }]}>
                5 G√ºnl√ºk √úcretsiz Program
              </Text>
              <Text style={[standardTextStyles.bodySmall, { color: '#666', textAlign: 'center', marginTop: 4 }]}>
                Temel nefes teknikleri ile ba≈ülayƒ±n
              </Text>
            </TouchableOpacity>
            
            <TouchableOpacity
              style={[styles.programOptionButton, { backgroundColor: 'rgba(34, 139, 34, 0.1)', borderColor: '#228B22', marginBottom: 12 }]}
              onPress={() => {
                setShowProgramOptionsModal(false);
                logUserAction('Navigate to Premium Screen');
                navigation.navigate('Premium');
              }}
            >
              <Text style={[standardTextStyles.buttonMedium, { color: '#228B22', fontWeight: 'bold' }]}>
                21 G√ºnl√ºk Ki≈üiselle≈ütirilmi≈ü Program
              </Text>
              <Text style={[standardTextStyles.bodySmall, { color: '#666', textAlign: 'center', marginTop: 4 }]}>
                Sabah-ak≈üam premium teknikler, geli≈ümi≈ü √∂zellikler ve daha fazlasƒ±..
              </Text>
            </TouchableOpacity>
            
            <TouchableOpacity
              style={[styles.programOptionButton, { backgroundColor: 'rgba(158, 158, 158, 0.1)', borderColor: '#9E9E9E' }]}
              onPress={() => setShowProgramOptionsModal(false)}
            >
              <Text style={[standardTextStyles.buttonMedium, { color: '#9E9E9E' }]}>
                ƒ∞ptal
              </Text>
            </TouchableOpacity>
          </View>
        </View>
      </Modal>
    </ImageBackground>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    paddingHorizontal: 20,
    paddingTop: 100,
  },
  scrollContent: {
    padding: 20,
    paddingBottom: 40,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingHorizontal: 20,
    paddingVertical: 20,
  },
  welcomeText: {
    ...standardTextStyles.sectionTitle,
    flex: 1,
  },
  logoutButton: {
    borderRadius: 12,
    paddingHorizontal: 16,
    paddingVertical: 8,
    borderWidth: 1,
  },
  logoutButtonText: {
    ...standardTextStyles.buttonSmall,
  },
  statsContainer: {
    flexDirection: 'row',
    justifyContent: 'space-around',
    paddingHorizontal: 20,
    marginBottom: 30,
  },
  statCard: {
    width: 140,
    borderRadius: 18,
    padding: 18,
    marginRight: 16,
    alignItems: 'center',
    justifyContent: 'center',
    backgroundColor: 'rgba(245, 245, 220, 0.08)',
    borderWidth: 1,
    borderColor: '#DDD',
    minHeight: 120,
  },
  statIcon: {
    fontSize: 32,
    marginBottom: 6,
  },
  statLabel: {
    ...standardTextStyles.label,
    textAlign: 'center',
    marginBottom: 2,
  },
  statNumber: {
    ...standardTextStyles.cardTitle,
    textAlign: 'center',
  },
  programCard: {
    borderRadius: 20,
    padding: 24,
    marginHorizontal: 20,
    marginBottom: 30,
    shadowOffset: {
      width: 0,
      height: 4,
    },
    shadowOpacity: 0.1,
    shadowRadius: 12,
    elevation: 8,
  },
  programTitle: {
    ...standardTextStyles.cardTitle,
    marginBottom: 8,
  },
  programSubtitle: {
    ...standardTextStyles.bodyMedium,
    marginBottom: 8,
  },
  programProgress: {
    ...standardTextStyles.bodySmall,
    marginBottom: 20,
  },
  programButton: {
    borderRadius: 12,
    paddingVertical: 12,
    paddingHorizontal: 20,
    alignItems: 'center',
    backgroundColor: 'transparent',
    borderWidth: 1,
    borderColor: '#DDD',
  },
  programButtonText: {
    ...standardTextStyles.buttonMedium,
    color: '#222',
    textAlign: 'center',
  },
  quickExercises: {
    paddingHorizontal: 20,
    marginBottom: 30,
    marginTop: 10,
  },
  sectionTitle: {
    ...standardTextStyles.sectionTitle,
    marginBottom: 16,
  },
  exerciseCard: {
    borderRadius: 16,
    padding: 20,
    marginBottom: 12,
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.1,
    shadowRadius: 8,
    elevation: 4,
  },
  exerciseTitle: {
    ...standardTextStyles.cardTitle,
    marginBottom: 4,
  },
  exerciseDescription: {
    ...standardTextStyles.bodyMedium,
    marginBottom: 6,
  },
  exerciseDuration: {
    ...standardTextStyles.bodyMedium,
  },
  actionButtons: {
    paddingHorizontal: 20,
    marginBottom: 30,
  },
  assessmentButton: {
    borderRadius: 16,
    paddingVertical: 16,
    paddingHorizontal: 20,
    alignItems: 'center',
    marginBottom: 16,
    shadowOffset: {
      width: 0,
      height: 4,
    },
    shadowOpacity: 0.2,
    shadowRadius: 8,
    elevation: 8,
  },
  assessmentButtonText: {
    ...standardTextStyles.buttonLarge,
  },
  settingsButton: {
    borderRadius: 16,
    paddingVertical: 16,
    paddingHorizontal: 20,
    alignItems: 'center',
    backgroundColor: 'transparent',
    borderWidth: 1,
    borderColor: '#DDD',
  },
  settingsButtonText: {
    ...standardTextStyles.buttonMedium,
    color: '#F5F5DC',
    textAlign: 'center',
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  loadingText: {
    ...standardTextStyles.bodyLarge,
  },
  statsCard: {
    borderRadius: 16,
    padding: 20,
    margin: 20,
    marginBottom: 0,
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.05,
    shadowRadius: 4,
    elevation: 2,
  },
  statsRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 12,
  },
  statsItem: {
    flex: 1,
    alignItems: 'center',
  },
  statsValue: {
    ...standardTextStyles.cardTitle,
  },
  statsLabel: {
    ...standardTextStyles.caption,
    marginTop: 2,
  },
  backgroundImage: {
    flex: 1,
    width: '100%',
    height: '100%',
    position: 'absolute',
    top: 0,
    left: 0,
  },
  warningButton: {
    borderRadius: 12,
    paddingVertical: 8,
    paddingHorizontal: 12,
    alignItems: 'center',
    justifyContent: 'center',
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.2,
    shadowRadius: 4,
    elevation: 4,
  },
  modalOverlay: {
    flex: 1,
    backgroundColor: 'rgba(0, 0, 0, 0.7)',
    justifyContent: 'center',
    alignItems: 'center',
  },
  modalContent: {
    backgroundColor: 'rgba(245, 245, 220, 0.95)',
    borderRadius: 20,
    padding: 24,
    margin: 20,
    maxWidth: 350,
    shadowOffset: {
      width: 0,
      height: 4,
    },
    shadowOpacity: 0.3,
    shadowRadius: 8,
    elevation: 8,
  },
  modalTitle: {
    ...standardTextStyles.cardTitle,
    color: '#FF6B35',
    textAlign: 'center',
    marginBottom: 20,
    fontWeight: 'bold',
  },
  warningSection: {
    marginBottom: 16,
  },
  warningSectionTitle: {
    ...standardTextStyles.bodyMedium,
    color: '#D32F2F',
    fontWeight: 'bold',
    marginBottom: 8,
  },
  warningText: {
    ...standardTextStyles.bodySmall,
    color: '#D32F2F',
    marginBottom: 4,
    marginLeft: 8,
  },
  safeSection: {
    marginBottom: 20,
  },
  safeSectionTitle: {
    ...standardTextStyles.bodyMedium,
    color: '#388E3C',
    fontWeight: 'bold',
    marginBottom: 8,
  },
  safeText: {
    ...standardTextStyles.bodySmall,
    color: '#388E3C',
    marginBottom: 4,
    marginLeft: 8,
  },
  ageSection: {
    marginBottom: 16,
  },
  ageSectionTitle: {
    ...standardTextStyles.bodyMedium,
    color: '#1976D2',
    fontWeight: 'bold',
    marginBottom: 8,
  },
  ageText: {
    ...standardTextStyles.bodySmall,
    color: '#1976D2',
    marginBottom: 4,
    marginLeft: 8,
  },
  modalButton: {
    backgroundColor: '#4CAF50',
    borderRadius: 12,
    paddingVertical: 12,
    paddingHorizontal: 24,
    alignItems: 'center',
  },
  modalButtonText: {
    ...standardTextStyles.buttonMedium,
    color: '#FFFFFF',
    fontWeight: 'bold',
  },
  sleepMusicSection: {
    marginTop: 20,
    marginBottom: 20,
  },
  sleepMusicCard: {
    borderRadius: 16,
    padding: 20,
    marginHorizontal: 20,
    marginBottom: 20,
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.1,
    shadowRadius: 8,
    elevation: 4,
  },
  sleepMusicContent: {
    flexDirection: 'row',
    alignItems: 'center',
  },
  sleepMusicEmoji: {
    fontSize: 48,
    marginRight: 16,
  },
  sleepMusicTextContainer: {
    flex: 1,
  },
  arrowIcon: {
    fontSize: 24,
    color: '#F5F5DC',
    fontWeight: 'bold',
    textShadowColor: 'rgba(0, 0, 0, 0.8)',
    textShadowOffset: { width: 1, height: 1 },
    textShadowRadius: 2,
  },
  programOptionButton: {
    borderRadius: 12,
    paddingVertical: 16,
    paddingHorizontal: 20,
    alignItems: 'center',
    borderWidth: 2,
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.1,
    shadowRadius: 4,
    elevation: 3,
  },
}); 